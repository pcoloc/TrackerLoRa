import { Injectable, NgZone, Inject } from '@angular/core';
import { from, of, animationFrameScheduler } from 'rxjs';
import { map, observeOn, shareReplay, tap } from 'rxjs/operators';
import { LOTTIE_OPTIONS, } from './symbols';
import * as i0 from "@angular/core";
function convertPlayerOrLoaderToObservable(player, useWebWorker) {
    const playerOrLoader = player();
    const player$ = playerOrLoader instanceof Promise
        ? from(playerOrLoader).pipe(map(module => module.default || module))
        : of(playerOrLoader);
    return player$.pipe(tap(player => player.useWebWorker(useWebWorker)), shareReplay({ bufferSize: 1, refCount: true }));
}
export class AnimationLoader {
    constructor(ngZone, options) {
        this.ngZone = ngZone;
        this.options = options;
        this.player$ = convertPlayerOrLoaderToObservable(this.options.player, this.options.useWebWorker).pipe(observeOn(animationFrameScheduler));
    }
    loadAnimation(options) {
        return this.player$.pipe(map(player => this.createAnimationItem(player, options)));
    }
    resolveOptions(options, container) {
        return Object.assign({
            container,
            renderer: 'svg',
            loop: true,
            autoplay: true,
        }, options);
    }
    createAnimationItem(player, options) {
        return this.ngZone.runOutsideAngular(() => player.loadAnimation(options));
    }
}
/** @nocollapse */ /** @nocollapse */ AnimationLoader.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.2", ngImport: i0, type: AnimationLoader, deps: [{ token: i0.NgZone }, { token: LOTTIE_OPTIONS }], target: i0.ɵɵFactoryTarget.Injectable });
/** @nocollapse */ /** @nocollapse */ AnimationLoader.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.2.2", ngImport: i0, type: AnimationLoader });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.2", ngImport: i0, type: AnimationLoader, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [LOTTIE_OPTIONS]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5pbWF0aW9uLWxvYWRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYnMvbmd4LWxvdHRpZS9zcmMvbGliL2FuaW1hdGlvbi1sb2FkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNELE9BQU8sRUFBYyxJQUFJLEVBQUUsRUFBRSxFQUFFLHVCQUF1QixFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVsRSxPQUFPLEVBQ0wsY0FBYyxHQVFmLE1BQU0sV0FBVyxDQUFDOztBQUVuQixTQUFTLGlDQUFpQyxDQUN4QyxNQUFtQyxFQUNuQyxZQUFzQjtJQUV0QixNQUFNLGNBQWMsR0FBRyxNQUFNLEVBQUUsQ0FBQztJQUNoQyxNQUFNLE9BQU8sR0FDWCxjQUFjLFlBQVksT0FBTztRQUMvQixDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUFJLE1BQU0sQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLENBQUM7SUFFekIsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FDVixNQUF3RSxDQUFDLFlBQVksQ0FDcEYsWUFBWSxDQUNiLENBQ0YsRUFDRCxXQUFXLENBQUMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUMvQyxDQUFDO0FBQ0osQ0FBQztBQUdELE1BQU0sT0FBTyxlQUFlO0lBTTFCLFlBQW9CLE1BQWMsRUFBa0MsT0FBc0I7UUFBdEUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFrQyxZQUFPLEdBQVAsT0FBTyxDQUFlO1FBTGhGLFlBQU8sR0FBRyxpQ0FBaUMsQ0FDbkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUMxQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDO0lBRWtELENBQUM7SUFFOUYsYUFBYSxDQUNYLE9BQTBEO1FBRTFELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUVELGNBQWMsQ0FDWixPQUFnQyxFQUNoQyxTQUFzQjtRQUV0QixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQ2xCO1lBQ0UsU0FBUztZQUNULFFBQVEsRUFBRSxLQUFLO1lBQ2YsSUFBSSxFQUFFLElBQUk7WUFDVixRQUFRLEVBQUUsSUFBSTtTQUNmLEVBQ0QsT0FBTyxDQUNSLENBQUM7SUFDSixDQUFDO0lBRVMsbUJBQW1CLENBQzNCLE1BQW9CLEVBQ3BCLE9BQTBEO1FBRTFELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDNUUsQ0FBQzs7a0pBbENVLGVBQWUsd0NBTWtCLGNBQWM7c0pBTi9DLGVBQWU7MkZBQWYsZUFBZTtrQkFEM0IsVUFBVTs7MEJBTzRCLE1BQU07MkJBQUMsY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE5nWm9uZSwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20sIG9mLCBhbmltYXRpb25GcmFtZVNjaGVkdWxlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBvYnNlcnZlT24sIHNoYXJlUmVwbGF5LCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7XG4gIExPVFRJRV9PUFRJT05TLFxuICBMb3R0aWVQbGF5ZXIsXG4gIExvdHRpZU9wdGlvbnMsXG4gIEFuaW1hdGlvbkl0ZW0sXG4gIEFuaW1hdGlvbk9wdGlvbnMsXG4gIEFuaW1hdGlvbkNvbmZpZ1dpdGhEYXRhLFxuICBBbmltYXRpb25Db25maWdXaXRoUGF0aCxcbiAgTG90dGllUGxheWVyRmFjdG9yeU9yTG9hZGVyLFxufSBmcm9tICcuL3N5bWJvbHMnO1xuXG5mdW5jdGlvbiBjb252ZXJ0UGxheWVyT3JMb2FkZXJUb09ic2VydmFibGUoXG4gIHBsYXllcjogTG90dGllUGxheWVyRmFjdG9yeU9yTG9hZGVyLFxuICB1c2VXZWJXb3JrZXI/OiBib29sZWFuLFxuKTogT2JzZXJ2YWJsZTxMb3R0aWVQbGF5ZXI+IHtcbiAgY29uc3QgcGxheWVyT3JMb2FkZXIgPSBwbGF5ZXIoKTtcbiAgY29uc3QgcGxheWVyJCA9XG4gICAgcGxheWVyT3JMb2FkZXIgaW5zdGFuY2VvZiBQcm9taXNlXG4gICAgICA/IGZyb20ocGxheWVyT3JMb2FkZXIpLnBpcGUobWFwKG1vZHVsZSA9PiBtb2R1bGUuZGVmYXVsdCB8fCBtb2R1bGUpKVxuICAgICAgOiBvZihwbGF5ZXJPckxvYWRlcik7XG5cbiAgcmV0dXJuIHBsYXllciQucGlwZShcbiAgICB0YXAocGxheWVyID0+XG4gICAgICAocGxheWVyIGFzIHVua25vd24gYXMgeyB1c2VXZWJXb3JrZXI6ICh1c2VXZWJXb3JrZXI/OiBib29sZWFuKSA9PiB2b2lkIH0pLnVzZVdlYldvcmtlcihcbiAgICAgICAgdXNlV2ViV29ya2VyLFxuICAgICAgKSxcbiAgICApLFxuICAgIHNoYXJlUmVwbGF5KHsgYnVmZmVyU2l6ZTogMSwgcmVmQ291bnQ6IHRydWUgfSksXG4gICk7XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBbmltYXRpb25Mb2FkZXIge1xuICBwcm90ZWN0ZWQgcGxheWVyJCA9IGNvbnZlcnRQbGF5ZXJPckxvYWRlclRvT2JzZXJ2YWJsZShcbiAgICB0aGlzLm9wdGlvbnMucGxheWVyLFxuICAgIHRoaXMub3B0aW9ucy51c2VXZWJXb3JrZXIsXG4gICkucGlwZShvYnNlcnZlT24oYW5pbWF0aW9uRnJhbWVTY2hlZHVsZXIpKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5nWm9uZTogTmdab25lLCBASW5qZWN0KExPVFRJRV9PUFRJT05TKSBwcml2YXRlIG9wdGlvbnM6IExvdHRpZU9wdGlvbnMpIHt9XG5cbiAgbG9hZEFuaW1hdGlvbihcbiAgICBvcHRpb25zOiBBbmltYXRpb25Db25maWdXaXRoRGF0YSB8IEFuaW1hdGlvbkNvbmZpZ1dpdGhQYXRoLFxuICApOiBPYnNlcnZhYmxlPEFuaW1hdGlvbkl0ZW0+IHtcbiAgICByZXR1cm4gdGhpcy5wbGF5ZXIkLnBpcGUobWFwKHBsYXllciA9PiB0aGlzLmNyZWF0ZUFuaW1hdGlvbkl0ZW0ocGxheWVyLCBvcHRpb25zKSkpO1xuICB9XG5cbiAgcmVzb2x2ZU9wdGlvbnMoXG4gICAgb3B0aW9uczogQW5pbWF0aW9uT3B0aW9ucyB8IG51bGwsXG4gICAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcbiAgKTogQW5pbWF0aW9uQ29uZmlnV2l0aERhdGEgfCBBbmltYXRpb25Db25maWdXaXRoUGF0aCB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXG4gICAgICB7XG4gICAgICAgIGNvbnRhaW5lcixcbiAgICAgICAgcmVuZGVyZXI6ICdzdmcnLFxuICAgICAgICBsb29wOiB0cnVlLFxuICAgICAgICBhdXRvcGxheTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBvcHRpb25zLFxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlQW5pbWF0aW9uSXRlbShcbiAgICBwbGF5ZXI6IExvdHRpZVBsYXllcixcbiAgICBvcHRpb25zOiBBbmltYXRpb25Db25maWdXaXRoRGF0YSB8IEFuaW1hdGlvbkNvbmZpZ1dpdGhQYXRoLFxuICApOiBBbmltYXRpb25JdGVtIHtcbiAgICByZXR1cm4gdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gcGxheWVyLmxvYWRBbmltYXRpb24ob3B0aW9ucykpO1xuICB9XG59XG4iXX0=